<?xml version="1.0" encoding="UTF-8"?>
<!-- Local rules for Wazuh CI/CD Project -->

<group name="mikrotik,">
  <rule id="100100" level="0">
    <decoded_as>mikrotik</decoded_as>
    <description>MikroTik grouping rule</description>
  </rule>

  <rule id="100101" level="3">
    <decoded_as>mikrotik</decoded_as>
    <description>MikroTik: Local rules for Wazuh CI/CD Project.</description>
  </rule>

  <rule id="100110" level="5" overwrite="yes">
    <if_sid>100101</if_sid>
    <match>user successfully logged in</match>
    <description>MikroTik: User login success</description>
    <group>authentication_success,pci_dss_10.2.5,gpg13_7.1,gpg13_7.2,</group>
  </rule>

  <rule id="100111" level="7" overwrite="yes">
    <if_sid>100101</if_sid>
    <match>login failure for user</match>
    <description>MikroTik: User login failure</description>
    <group>authentication_failed,pci_dss_10.2.4,pci_dss_10.2.5,gpg13_7.1,</group>
  </rule>

  <rule id="111000" level="10">
    <if_sid>100111</if_sid>
    <same_source_ip />
    <occurrences>5</occurrences>
    <time_frame>60</time_frame>
    <description>MikroTik: Multiple login failures from same source IP.</description>
    <mitre>
      <id>T1110</id>
      <id>T1078</id>
    </mitre>
    <group>authentication_failures,pci_dss_10.2.4,pci_dss_10.2.5,pci_dss_11.4,gpg13_7.1,</group>
  </rule>
</group>

<group name="brute_force,">
  <rule id="111001" level="10" frequency="8" timeframe="120">
    <if_matched_sid>100102</if_matched_sid>
    <same_source_ip />
    <description>MikroTik: Multiple failed login attempts from same source (brute force attack)</description>
    <mitre>
      <id>T1110</id>
      <id>T1110.001</id>
    </mitre>
    <group>authentication_failures,pci_dss_10.2.4,pci_dss_10.2.5,pci_dss_11.4,gpg13_7.8,gdpr_IV_35.7.d,gdpr_IV_32.2,hipaa_164.312.b,nist_800_53_AU.14,nist_800_53_AC.7,nist_800_53_SI.4,tsc_CC6.1.3,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
</group>

<group name="windows,">
  <rule id="100200" level="3">
    <decoded_as>windows</decoded_as>
    <description>Windows: Local rules for Wazuh CI/CD Project</description>
  </rule>

  <rule id="100201" level="5">
    <if_sid>100200</if_sid>
    <match>User login successful</match>
    <description>Windows: User login success</description>
    <group>authentication_success,pci_dss_10.2.5,gpg13_7.1,gpg13_7.2,</group>
  </rule>

  <rule id="100202" level="7">
    <if_sid>100200</if_sid>
    <match>User login failed</match>
    <description>Windows: User login failure</description>
    <group>authentication_failed,pci_dss_10.2.4,pci_dss_10.2.5,gpg13_7.1,</group>
  </rule>
</group>

<group name="brute_force,">
  <rule id="111005" level="10">
    <if_sid>100202</if_sid>
    <same_source_ip />
    <occurrences>5</occurrences>
    <time_frame>60</time_frame>
    <description>Windows: Multiple login failures from same source IP.</description>
    <mitre>
      <id>T1110</id>
      <id>T1078</id>
    </mitre>
    <group>authentication_failures,pci_dss_10.2.4,pci_dss_10.2.5,pci_dss_11.4,gpg13_7.1,</group>
  </rule>
</group>

<group name="ubuntu,">
  <rule id="100300" level="3">
    <decoded_as>ubuntu</decoded_as>
    <description>Ubuntu: Local rules for Wazuh CI/CD Project</description>
  </rule>

  <rule id="100301" level="5">
    <if_sid>100300</if_sid>
    <match>User login successful</match>
    <description>Ubuntu: User login success</description>
    <group>authentication_success,pci_dss_10.2.5,gpg13_7.1,gpg13_7.2,</group>
  </rule>

  <rule id="100302" level="7">
    <if_sid>100300</if_sid>
    <match>User login failed</match>
    <description>Ubuntu: User login failure</description>
    <group>authentication_failed,pci_dss_10.2.4,pci_dss_10.2.5,gpg13_7.1,</group>
  </rule>
</group>

<group name="brute_force,">
  <rule id="111010" level="10">
    <if_sid>100302</if_sid>
    <same_source_ip />
    <occurrences>5</occurrences>
    <time_frame>60</time_frame>
    <description>Ubuntu: Multiple login failures from same source IP.</description>
    <mitre>
      <id>T1110</id>
      <id>T1078</id>
    </mitre>
    <group>authentication_failures,pci_dss_10.2.4,pci_dss_10.2.5,pci_dss_11.4,gpg13_7.1,</group>
  </rule>
</group>

<group name="yara,">
  <rule id="108000" level="3">
    <decoded_as>yara</decoded_as>
    <description>YARA: Local rules for Wazuh CI/CD Project</description>
  </rule>

  <rule id="108001" level="10">
    <if_sid>108000</if_sid>
    <match>Positive match found</match>
    <description>YARA: Positive match for malware detected</description>
    <mitre>
      <id>T1204</id>
      <id>T1059</id>
    </mitre>
    <group>malware,pci_dss_5.1,pci_dss_5.2,pci_dss_11.4,gpg13_4.2,</group>
  </rule>
</group> 